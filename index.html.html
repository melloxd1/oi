<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>IPTV Web Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  margin:0;
  background:#0f0f0f;
  font-family: Arial, sans-serif;
  color:#fff;
}
header {
  padding:15px;
  font-size:22px;
  font-weight:bold;
}
.controls {
  padding:15px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
input, textarea, button {
  padding:10px;
  border-radius:5px;
  border:none;
}
textarea {
  width:100%;
  height:120px;
}
button {
  background:#e50914;
  color:#fff;
  cursor:pointer;
}
#channels {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:15px;
  padding:15px;
}
.channel {
  background:#1c1c1c;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  position:relative;
}
.channel:hover {
  background:#333;
}
.badge {
  position:absolute;
  top:5px;
  right:5px;
  font-size:11px;
  padding:2px 6px;
  border-radius:4px;
}
.ok { background:#2ecc71; }
.no { background:#e74c3c; }

#playerModal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
video {
  width:90%;
  max-width:900px;
}
.close {
  position:absolute;
  top:20px;
  right:30px;
  font-size:28px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>IPTV Web Player</header>

<div class="controls">
  <input type="file" id="fileInput" accept=".m3u">
  <button onclick="loadFile()">Arquivo M3U</button>
</div>

<div class="controls">
  <textarea id="m3uText" placeholder="Cole a lista M3U completa aqui"></textarea>
  <button onclick="loadText()">Colar Lista</button>
</div>

<div id="channels"></div>

<div id="playerModal">
  <div class="close" onclick="closePlayer()">✖</div>
  <video id="video" controls autoplay></video>
</div>

<script>
let channels = [];

function parseM3U(text) {
  channels = [];
  const lines = text.split("\n");
  let name = "";

  lines.forEach(line => {
    line = line.trim();
    if (line.startsWith("#EXTINF")) {
      name = line.split(",").pop();
    } else if (line.startsWith("http")) {
      const isHLS = line.includes(".m3u8");
      channels.push({ name, url: line, ok: isHLS });
    }
  });

  render();
}

function render() {
  const box = document.getElementById("channels");
  box.innerHTML = "";
  channels.forEach(ch => {
    const div = document.createElement("div");
    div.className = "channel";
    div.innerHTML = `
      <div class="badge ${ch.ok ? 'ok':'no'}">
        ${ch.ok ? 'WEB OK':'INCOMPATÍVEL'}
      </div>
      ${ch.name || 'Sem nome'}
    `;
    if (ch.ok) {
      div.onclick = () => play(ch.url);
    }
    box.appendChild(div);
  });
}

function play(url) {
  const video = document.getElementById("video");
  const modal = document.getElementById("playerModal");
  modal.style.display = "flex";

  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

function closePlayer() {
  const video = document.getElementById("video");
  video.pause();
  video.src = "";
  document.getElementById("playerModal").style.display = "none";
}

function loadFile() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => parseM3U(e.target.result);
  reader.readAsText(file);
}

function loadText() {
  const text = document.getElementById("m3uText").value;
  if (text.trim()) parseM3U(text);
}
</script>

</body>
</html>
